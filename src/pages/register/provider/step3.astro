---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
---

<Layout title="Selecciona tus clientes objetivo | Registro Proveedor B2B Connect">
  <Header />
  
  <main class="pt-32 pb-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <!-- Indicador de progreso -->
        <div class="mb-12">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                ✓
              </div>
              <div class="ml-3 text-blue-600 font-semibold">Rubros</div>
            </div>
            <div class="flex-grow mx-4 h-1 bg-blue-600"></div>
            <div class="flex items-center">
              <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                ✓
              </div>
              <div class="ml-3 text-blue-600 font-semibold">Ubicación</div>
            </div>
            <div class="flex-grow mx-4 h-1 bg-blue-600"></div>
            <div class="flex items-center">
              <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                3
              </div>
              <div class="ml-3 text-blue-600 font-semibold">Clientes</div>
            </div>
          </div>
        </div>
        
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6 text-center">
          ¿Con qué tipo de clientes trabajas?
        </h1>
        
        <p class="text-gray-600 text-lg mb-8 text-center">
          Selecciona los perfiles de empresas que más se ajustan a tus clientes ideales.
        </p>
        
        <div class="space-y-6 mb-12">
          <!-- Tamaño de empresa -->
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Tamaño de empresas</h3>
            <p class="text-gray-600 mb-5">Selecciona los tamaños de empresa a los que ofreces tus servicios (selecciona todos los que apliquen)</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer company-size-option">
                <input type="checkbox" name="company_size" value="micro" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Micro (1-10)</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer company-size-option">
                <input type="checkbox" name="company_size" value="small" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Pequeña (11-50)</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer company-size-option">
                <input type="checkbox" name="company_size" value="medium" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Mediana (51-250)</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer company-size-option">
                <input type="checkbox" name="company_size" value="large" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Grande (250+)</span>
              </label>
            </div>
          </div>
          
          <!-- Sectores de interés -->
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Sectores de interés</h3>
            <p class="text-gray-600 mb-5">Selecciona los sectores en los que operan tus clientes ideales (selecciona todos los que apliquen)</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="tech" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Tecnología</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="manufacturing" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Manufactura</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="health" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Salud</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="financial" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Servicios financieros</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="retail" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Comercio minorista</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer sector-option">
                <input type="checkbox" name="sectors" value="education" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Educación</span>
              </label>
            </div>
          </div>
          
          <!-- Presupuesto estimado -->
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Presupuesto mínimo</h3>
            <p class="text-gray-600 mb-5">Indica el presupuesto mínimo que manejas para tus servicios</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer budget-option">
                <input type="radio" name="budget" value="small" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Menos de 1.000€</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer budget-option">
                <input type="radio" name="budget" value="medium" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>1.000€ - 10.000€</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer budget-option">
                <input type="radio" name="budget" value="large" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>10.000€ - 50.000€</span>
              </label>
              
              <label class="flex items-center space-x-3 border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer budget-option">
                <input type="radio" name="budget" value="enterprise" class="h-5 w-5 text-blue-600 focus:ring-blue-500">
                <span>Más de 50.000€</span>
              </label>
            </div>
          </div>
        </div>
        
        <div class="text-center mt-12">
          <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="/register/provider/step2" class="px-6 py-3 border border-blue-600 text-blue-600 font-medium rounded-lg transition-colors hover:bg-blue-50">
              Atrás
            </a>
            <button 
              id="finish-button" 
              type="button"
              class="px-8 py-4 bg-blue-600 text-white font-medium rounded-lg transition-colors shadow-md hover:bg-blue-700"
            >
              Buscar Clientes Potenciales
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <Footer />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Verificar que el usuario viene del flujo correcto
    const providerData = sessionStorage.getItem('providerData');
    const providerIndustries = sessionStorage.getItem('providerIndustries');
    const providerLocation = sessionStorage.getItem('providerLocation');
    
    if (!providerData || !providerIndustries || !providerLocation) {
      window.location.href = '/register/provider/form';
      return;
    }

    // Estilizar opciones seleccionadas
    const companySizeOptions = document.querySelectorAll('.company-size-option');
    const sectorOptions = document.querySelectorAll('.sector-option');
    const budgetOptions = document.querySelectorAll('.budget-option');
    
    companySizeOptions.forEach(option => {
      const checkbox = option.querySelector('input[type="checkbox"]');
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          option.classList.add('border-blue-500', 'bg-blue-50');
        } else {
          option.classList.remove('border-blue-500', 'bg-blue-50');
        }
      });
    });
    
    sectorOptions.forEach(option => {
      const checkbox = option.querySelector('input[type="checkbox"]');
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          option.classList.add('border-blue-500', 'bg-blue-50');
        } else {
          option.classList.remove('border-blue-500', 'bg-blue-50');
        }
      });
    });
    
    budgetOptions.forEach(option => {
      const radio = option.querySelector('input[type="radio"]');
      radio.addEventListener('change', () => {
        budgetOptions.forEach(opt => {
          opt.classList.remove('border-blue-500', 'bg-blue-50');
        });
        
        if (radio.checked) {
          option.classList.add('border-blue-500', 'bg-blue-50');
        }
      });
    });
    
    // Manejar el botón de finalización
    const finishButton = document.getElementById('finish-button');
    if (finishButton) {
      finishButton.addEventListener('click', () => {
        // Recopilar los datos seleccionados
        const selectedCompanySizes = Array.from(document.querySelectorAll('input[name="company_size"]:checked')).map(input => input.value);
        const selectedSectors = Array.from(document.querySelectorAll('input[name="sectors"]:checked')).map(input => input.value);
        const selectedBudget = document.querySelector('input[name="budget"]:checked')?.value || '';
        
        // Guardar las preferencias del proveedor
        const clientPreferences = {
          companySizes: selectedCompanySizes,
          sectors: selectedSectors,
          budget: selectedBudget
        };
        
        sessionStorage.setItem('providerClientPreferences', JSON.stringify(clientPreferences));
        
        // Simular búsqueda
        finishButton.disabled = true;
        finishButton.innerHTML = '<span class="inline-block animate-spin mr-2">⏳</span> Buscando clientes...';
        
        setTimeout(() => {
          window.location.href = '/register/provider/results';
        }, 2000);
      });
    }
  });
</script>
